From 5a59f7a08076a5ce87d629707b7340fa72c23812 Mon Sep 17 00:00:00 2001
From: ARGINT DRAGOS IULIAN <dragosargint21@gmail.com>
Date: Tue, 20 Jul 2021 11:54:24 +0300
Subject: [PATCH] Modify-cancel-handler

Signed-off-by: ARGINT DRAGOS IULIAN <dragosargint21@gmail.com>
---
 src/thread/pthread_cancel.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/thread/pthread_cancel.c b/src/thread/pthread_cancel.c
index 3d22922..64a6a33 100644
--- a/src/thread/pthread_cancel.c
+++ b/src/thread/pthread_cancel.c
@@ -60,11 +60,11 @@ static void cancel_handler(int sig, siginfo_t *si, void *ctx)
 	_sigaddset(&uc->uc_sigmask, SIGCANCEL);
 
 	if (self->cancelasync || pc >= (uintptr_t)__cp_begin && pc < (uintptr_t)__cp_end) {
-		uc->uc_mcontext.MC_PC = (uintptr_t)__cp_cancel;
-		return;
+		__cancel(); //uc->uc_mcontext.MC_PC = (uintptr_t)__cp_cancel;
+		//return;
 	}
 
-	__syscall(SYS_tkill, self->tid, SIGCANCEL);
+	//__syscall(SYS_tkill, self->tid, SIGCANCEL);
 }
 
 void __testcancel()
-- 
2.17.1

